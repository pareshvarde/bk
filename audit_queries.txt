--families without members
select 
	F.FamilyId
from 
	Families f
	OUTER APPLY
	(	
		SELECT TOP 1 FamilyId FROM FamilyMemberAssociation tfma WHERE tfma.FamilyId = f.FamilyID
	) fma
WHERE
	fma.FamilyID IS NULL

--members without family
select 
	m.MemberId
from 
	Members m
	OUTER APPLY
	(	
		SELECT TOP 1 FamilyId FROM FamilyMemberAssociation tfma WHERE tfma.MemberId = m.MemberId
	) fma
WHERE
	fma.FamilyID IS NULL

--members without any default family
select 
	m.memberID
FROM
	members m
	OUTER APPLY
	(	
		SELECT TOP 1 FamilyId FROM FamilyMemberAssociation tfma WHERE tfma.MemberId = m.MemberId AND DefaultFamily = 1 
	) fma
WHERE
	fma.FamilyID IS NULL

--families without head of family	
select 
	F.FamilyId
from 
	Families f
	OUTER APPLY
	(	
		SELECT TOP 1 MemberID FROM Members tm WHERE tm.MemberID = f.HeadOfFamilyID				
	) fma
WHERE
	fma.MemberID IS NULL
	
--matrimony without correct status (alive, adult, single, dob)
SELECT
	m.MemberID
FROM
	Members m
	JOIN Matrimonials mat on mat.memberid = m.memberid
WHERE
	m.Alive = 0
	OR m.MaritalStatusId = 2
	OR m.DOB IS NULL
	OR (m.Gender = 1 AND m.DOB IS NOT NULL AND DATEDIFF(MONTH, '1982-10-15', GETDATE())/12 < 21) 
	OR (m.Gender = 0 AND m.DOB IS NOT NULL AND DATEDIFF(MONTH, '1982-10-15', GETDATE())/12 < 18)
